<html>
 <head>
  <script src="imageProcessingFunctions.js"></script>
  <style>
    input { width:25px; }
  </style>
  <script>
    // these globals are set in readImage()
    var imgWidth, imgHeight;
    var ctx;

    function loadImage() {
      var textbox = document.getElementById("filename");
      var filename = textbox.value;
      var canvas = document.getElementById("canvas");
      readImage(canvas,filename);
    }
    function processImage() {
      var imageData = ctx.getImageData(0, 0, imgWidth, imgHeight);
      greyscale(imageData);
      // threshold at 52 for initial segmentation
      threshold(imageData, 52);
      // invert the pixels so that foreground colour is 255, background is 0
      invert(imageData);
      // erosion with 8x8 kernel removes nearly all noise
      erode(imageData, 8);
      // dilation with kernel size 8x8
      // original object is almost back to where it was in terms of size/shape 
      // (what I have performed with erosion then dilation is actually opening)
      dilate(imageData, 8);
      // closing with kernel size 30x30 fills in the gap caused by the shine, without affecting it
      // very much in any other way
      dilate(imageData, 30);
      erode(imageData, 30);
      ctx.putImageData(imageData, 0, 0); 
      var whitepixels = countPixels(imageData,255);
      window.alert("Bubble size: "+whitepixels+" pixels");
    }
  </script>
 </head>

 <body>
   <canvas id="canvas" style="border-width:1px; border-style:solid;" width="500" height="500"></canvas><br>
   <input type="text" id="filename" style="width:600px;" value="images/bubble.jpg"> <input type="button" style="width:100px;" onclick="loadImage();" value="Load Image"><br>
   
    <input type="button" style="width:180px;" value="Process Image" onclick="processImage();">
 </body>
</html>
